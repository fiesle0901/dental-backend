generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model DentalRecord {
  id        String @id @default(uuid())
  patientId String?

  patient Patient? @relation(fields: [patientId], references: [id], onDelete: Cascade)

  patientSnapshot   PatientSnapshot?
  dentalHistory      DentalHistory?
  medicalHistory     MedicalHistory?

  dentalChart DentalChart?

  informedConsent  InformedConsent?
  treatmentRecords TreatmentRecord[]

  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  page1Completed Boolean @default(false)
  page2Completed Boolean @default(false)
  page3Completed Boolean @default(false)
  page4Completed Boolean @default(false)
}

model Patient { 
  id         String @id @default(uuid())
    
  firstName  String?
  lastName   String?
  birthdate  DateTime?
  sex        Sex?

  dentalRecords DentalRecord[]
}

model PatientSnapshot {
  id                 String          @id @default(uuid())
  dentalRecordId     String          @unique

  lastName           String?
  firstName          String?
  middleName         String?
  birthdate          DateTime?
  sex                Sex?
  nationality                  String?             @default("Filipino")
  religion           String?
  nickname           String?
  homeAddress        String?
  homeNo             String?
  occupation         String?
  officeNo           String?
  dentalInsurance    String?
  faxNo              String?
  effectiveDate      DateTime?
  cellMobileNo       String?
  emailAddress       String?
  parentGuardianName String?
  parentOccupation   String?
  referredBy         String?
  consultationReason String?
 
  record        DentalRecord      @relation(fields: [dentalRecordId], references: [id], onDelete: Cascade )
}

model DentalHistory {
  id              String  @id @default(uuid())
  dentalRecordId  String  @unique

  previousDentist String?
  lastDentalVisit String?
  record          DentalRecord @relation(fields: [dentalRecordId], references: [id], onDelete: Cascade)
}


model MedicalHistory {
  id                           String             @id @default(uuid())
  dentalRecordId String   @unique
  physicianName                String?
  physicianAddress             String?
  physicianSpecialty           String?
  physicianOfficeNumber        String?
  goodHealth                   YesNo?
  underMedicalTreatment        YesNo?
  medicalConditionBeingTreated String?
  seriousIllnessSurgery        YesNo?
  illnessOrOperationDetails    String?
  hospitalized                 YesNo?
  hospitalizationDetails       String?
  takingMedication             YesNo?
  medicationDetails            String?
  useTobacco                   YesNo?
  useAlcoholDrugs              YesNo?
  bleedingTime                 String?
  bloodType                    String?
  bloodPressure                String?
  forWomenOnly                 ForWomenOnly?
  allergies                    MedicalAllergies?
  medicalConditions            MedicalConditions?
  record                        DentalRecord            @relation(fields: [dentalRecordId], references: [id], onDelete: Cascade)
}

model MedicalAllergies {
  id               String         @id @default(uuid())
  medicalHistoryId String         @unique
  localAnesthetic  YesNo?
  penicillin       YesNo?
  antibiotics      YesNo?
  sulfaDrugs       YesNo?
  aspirin          YesNo?
  latex            YesNo?
  others           String?
  medicalHistory   MedicalHistory @relation(fields: [medicalHistoryId], references: [id], onDelete: Cascade)
}

model ForWomenOnly {
  id                 String         @id @default(uuid())
  medicalHistoryId   String         @unique
  pregnant           YesNo?
  nursing            YesNo?
  takingBirthControl YesNo?
  medicalHistory     MedicalHistory @relation(fields: [medicalHistoryId], references: [id], onDelete: Cascade)
}

model MedicalConditions {
  id                         String         @id @default(uuid())
  medicalHistoryId           String         @unique
  highBloodPressure          Boolean?
  lowBloodPressure           Boolean?
  epilepsyConvulsions        Boolean?
  aidsHivInfection           Boolean?
  sexuallyTransmittedDisease Boolean?
  stomachTroublesUlcers      Boolean?
  faintingSeizure            Boolean?
  rapidWeightLoss            Boolean?
  radiationTherapy           Boolean?
  jointReplacementImplant    Boolean?
  heartSurgery               Boolean?
  heartAttack                Boolean?
  thyroidProblem             Boolean?
  heartDisease               Boolean?
  heartMurmur                Boolean?
  hepatitisLiverDisease      Boolean?
  rheumaticFever             Boolean?
  hayFeverAllergies          Boolean?
  respiratoryProblems        Boolean?
  hepatitisJaundice          Boolean?
  tuberculosis               Boolean?
  swollenAnkles              Boolean?
  kidneyDisease              Boolean?
  diabetes                   Boolean?
  chestPain                  Boolean?
  stroke                     Boolean?
  cancerTumors               Boolean?
  anemia                     Boolean?
  angina                     Boolean?
  asthma                     Boolean?
  emphysema                  Boolean?
  bleedingProblems           Boolean?
  bloodDiseases              Boolean?
  headInjuries               Boolean?
  arthritisRheumatism        Boolean?
  other                      String?
  medicalHistory             MedicalHistory @relation(fields: [medicalHistoryId], references: [id], onDelete: Cascade)
}

model DentalChart {
  id             String @id @default(uuid())
  dentalRecordId String @unique
  

  record      DentalRecord          @relation(fields: [dentalRecordId], references: [id], onDelete: Cascade)
  teeth       ToothFinding[]
  occlusion   Occlusion?
  periodontal PeriodontalScreening?
  appliances Appliances[]
  tmd         Tmd[]
 

}

model ToothFinding {
  id            String             @id @default(uuid())
  dentalChartId String
  toothNumber   String
  condition     ToothCondition?
  dentalChart   DentalChart        @relation(fields: [dentalChartId], references: [id], onDelete: Cascade)
  restorations  ToothRestoration[]
  surgeries     ToothSurgery[]

  @@unique([dentalChartId, toothNumber])
}

model ToothRestoration {
  id      String          @id @default(uuid())
  toothId String
  type    RestorationType
  tooth   ToothFinding    @relation(fields: [toothId], references: [id], onDelete: Cascade)
}

model ToothSurgery {
  id           String       @id @default(uuid())
  toothId      String
  toothSurgery SurgeryType
  tooth        ToothFinding @relation(fields: [toothId], references: [id], onDelete: Cascade)
}

model PeriodontalScreening {
  id                    String      @id @default(uuid())
  dentalChartId         String      @unique
  gingivitis            Boolean     @default(false)
  earlyPeriodontitis    Boolean     @default(false)
  moderatePeriodontitis Boolean     @default(false)
  advancedPeriodontitis Boolean     @default(false)
  form                  DentalChart @relation(fields: [dentalChartId], references: [id], onDelete: Cascade)
}

model Occlusion {
  id               String      @id @default(uuid())
  dentalChartId    String      @unique
  molarClass       Boolean     @default(false)
  overjet          Boolean     @default(false)
  overbite         Boolean     @default(false)
  midlineDeviation Boolean     @default(false)
  crossbite        Boolean     @default(false)
  form             DentalChart @relation(fields: [dentalChartId], references: [id], onDelete: Cascade)
}

model Appliances {
  id            String      @id @default(uuid())
  dentalChartId String
  orthodontic   Boolean     @default(false)
  stayplate     Boolean     @default(false)
  others        String?
  form          DentalChart @relation(fields: [dentalChartId], references: [id], onDelete: Cascade)
}

model Tmd {
  id            String      @id @default(uuid())
  dentalChartId String
  clenching     Boolean     @default(false)
  clicking      Boolean     @default(false)
  trismus       Boolean     @default(false)
  muscleSpasm   Boolean     @default(false)
  form          DentalChart @relation(fields: [dentalChartId], references: [id], onDelete: Cascade)
}

enum Sex {
  M
  F
}

enum YesNo {
  Yes
  No
}

enum ToothCondition {
  PRESENT
  DECAYED
  MISSING_CARIES
  MISSING_OTHER
  IMPACTED
  SUPERNUMERARY
  ROOT_FRAGMENT
  UNERUPTED
}

enum RestorationType {
  AM
  CO
  JC
  AB
  ATT
  P
  IN
  IMP
  S
  RM
}

enum SurgeryType {
  EXTRACTION_CARIES
  EXTRACTION_OTHER
}

model InformedConsent {
  id            String @id @default(uuid())
  dentalRecordId String @unique

  treatment        Boolean @default(false)
  treatmentInitial String?

  drugsMedication        Boolean @default(false)
  drugsMedicationInitial String?

  changesInPlan        Boolean @default(false)
  changesInPlanInitial String?

  radiograph        Boolean @default(false)
  radiographInitial String?

  removalOfTeeth        Boolean @default(false)
  removalOfTeethInitial String?

  crownsBridges        Boolean @default(false)
  crownsBridgesInitial String?

  endodontics        Boolean @default(false)
  endodonticsInitial String?

  fillings        Boolean @default(false)
  fillingsInitial String?

  dentures        Boolean @default(false)
  denturesInitial String?

  patientSignature String?
  dentistSignature String?
  signedDate       DateTime?

  record DentalRecord @relation(fields: [dentalRecordId], references: [id], onDelete: Cascade)

   createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TreatmentRecord {
  id String @id @default(uuid())

  dentalRecordId String

  date            DateTime?
  toothQuantity   String?
  procedure       String?
  dentist         String?
  amountCharged   Int?
  amountPaid      Int?
  balance         Int?
  nextAppointment DateTime?

    record DentalRecord @relation(fields: [dentalRecordId], references: [id], onDelete: Cascade)


  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
